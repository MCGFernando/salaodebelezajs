
</main>

<script>
    
    document.addEventListener('DOMContentLoaded', function(){
    // nav Menu
    const menus = document.querySelectorAll('.slide-out')
    M.Sidenav.init(menus, {edge:'left'})
    var collapsibleElem = document.querySelectorAll('.collapsible');
    M.Collapsible.init(collapsibleElem);
   
})

document.addEventListener('DOMContentLoaded', function() {
    var elems = document.querySelectorAll('select');
    M.FormSelect.init(elems);
  });

  document.addEventListener('DOMContentLoaded', function() {
    var elems = document.querySelectorAll('.dropdown-trigger');
     M.Dropdown.init(elems,{coverTrigger:false, alignment:'right'});
     var elems = document.querySelectorAll('.modal');
    M.Modal.init(elems);
  });


const pesquisar = document.querySelector('.pesquisar')
const collection = document.querySelector('.collection')
pesquisar.addEventListener('keyup', e =>{
        
    fetch('http://localhost:3000/productoservico/autocomplete/' + e.target.value).then(response=>{
        return response.json() 
    }).then(data=>{
        console.log(data)
        data.forEach(d => {
            collection.innerHTML = `<li class="collection-item"><div>${d.productoServico}<a href="#!" class="secondary-content"><i class="material-icons">send</i></a></div></li>`
        })
        
    }).catch(error=>{
        console.log(error)
    })
})
const caixa = document.querySelector('.caixa')
collection.addEventListener('click', e => {
    const seachText = e.target.firstChild.data
    collection.innerHTML = ''
    pesquisar.value = ''
    fetch('http://localhost:3000/productoservico/autocomplete/' + seachText).then(response=>{
        return response.json() 
    }).then(data=>{
        //console.log(data)
        const html = `
        <tr>
            <td><input type="text" id="id" name="id" style="border:none" value="${data[0]._id}" readonly/></td>
            <td><input type="text" style="border:none" value="${data[0].productoServico}" readonly/></td>
            <td><input type="text" style="border:none" value="${data[0].valorVenda}"  readonly/></td>
            <td><input type="number" id="quantidade" name="quantidade" style="border:none" value="1" onkeyup="calc(${data[0].valorVenda})"></td>
            <td class="resultado">${data[0].valorVenda}</td>
            <td>
                <a href="#!" class="secondary-content"><i class="material-icons">send</i></a>
            </td>
        </tr>`
        caixa.innerHTML += html
        preemcheResumoVenda()
    }).catch(error=>{
        console.log(error)
    })
    
})

function calc(val){
    const resultado = document.querySelector('.resultado')
    const result = val * document.getElementById('quantidade').value
    resultado.innerHTML = result
    preemcheResumoVenda()
}
function preemcheResumoVenda(){
    const valorTotal = document.querySelectorAll('.resultado')
    //console.log(valorTotal)
    const valorTotalVenda = document.getElementById('valorTotalVenda')
    //console.log(valorTotalVenda)
    let total = 0
    for(let i = 0;i<valorTotal.length;i++){
        total += Number(valorTotal[i].innerText)
    }
    //console.log(total)
    valorTotalVenda.value = total
}
/* const tabela = document.querySelector('.tblCaixa')

tabela.addEventListener('keyup', e => {

}) */
</script>
